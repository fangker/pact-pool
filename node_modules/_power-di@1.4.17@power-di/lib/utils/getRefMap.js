"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

var metadata_1 = require("./metadata");

var getGlobalType_1 = require("./getGlobalType");

function getRefMap(clsType) {
  var initMaps = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
  var maps = initMaps;

  function scan(clsType) {
    var type = getGlobalType_1.getGlobalType(clsType);

    if (maps[type]) {
      return;
    }

    var refs = maps[type] = {
      count: 0,
      deps: []
    };
    metadata_1.getInjects(clsType.prototype).forEach(function (inj) {
      scan(inj.typeCls);
      maps[inj.globalType].count++;
      refs.deps.push({
        prop: inj.key,
        type: inj.globalType
      });
    });
  }

  scan(clsType);
  return maps;
}

exports.getRefMap = getRefMap;